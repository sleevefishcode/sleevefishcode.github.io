---
title: 'TULRN: Trajectory user linking on road networks'
date: 2023-03-20 15:28:05
categories: paper
tags: [TUL,Representation learning,Road networks]
---
发表于www（2022）Topical Collection: Special Issue on Spatiotemporal Data Management and Analytics for Recommend

[TULRN: Trajectory user linking on road networks | SpringerLink](https://link.springer.com/article/10.1007/s11280-022-01124-0 "论文地址")

未提供公开代码

# 摘要

为了更有效地解决轨迹用户链接(TUL)问题，我们提出了一种**基于GNN(图神经网络)和BiLSTM(双向长短期记忆)的新型半监督模型TULRN**(道路网络轨迹用户链接)。我们的研究与现有研究的主要区别在于，本文将TUL问题扩展到道路网络上，统一地充分**利用了道路网络的结构和轨迹的顺序特征**。扩展的原因是现实生活中许多轨迹通常是在道路网络上生成的，基于这些轨迹我们可以更精确地建模轨迹与用户之间的关系。具体而言，我们提出的模型TULRN包含四个主要组成部分:(1)将每个轨迹转换为道路段序列，构建路网感知的轨迹序列图RTSG;(2)使用权重感知GNN模块学习RTSG中节点的表示;(3)利用基于bilstm的模块学习轨迹的表示;(4)基于每个轨迹的嵌入，将轨迹与用户连接起来。在真实数据集上进行的大量实验表明，所提出的模型TULRN比最先进的方法表现得更好。

<!--more-->

# Introduction

从轨迹数据中可以发现移动个体和群体的流动模式，为基于位置的服务、人群管理、旅游监测等相关应用领域的研究提供方法和决策指导。它已成为数据挖掘领域的研究热点，引起了学术界的广泛关注。近年来，一些研究者开始关注轨迹用户链接(TUL)，因为其带来的显著好处，如在基于位置的社交网络[19]上进行下一次访问位置预测[14-18]和好友推荐。

过去的研究为解决道路交通问题做出了巨大贡献，但没有一项研究是针对道路网络的问题。不幸的是，在现实生活中，大多数轨迹是由许多不同的车辆在道路网络上生成的，如公共汽车、汽车和出租车

具体来说，研究道路网络上的TUL问题的原因有三个方面。

(1)虽然许多轨迹都是从现实生活中的路网中收集的，但目前还没有将轨迹与路网上的用户联系起来的工作，我们的研究可以填补这一空白。

(2)现有的研究需要在学习表示之前开发将轨迹转换为分段的方法，而所设计的方法对分割的性能有很大影响。与之不同的是，我们可以根据给定的地图信息，自动获得第3节中介绍的轨迹序列(TS)。

(3)除了轨迹的样本点，在给定路网的情况下，我们可以利用更多的信息，如路段和交叉口来提高轨迹表示学习的性能。

本文提出了一个新的半监督模型TULRN，它包含四个主要组成部分。(1)构建路网感知的轨迹序列图RTSG:根据轨迹的位置信息，将轨迹经过地图匹配后转化为道路段序列，然后将轨迹序列与路网图合并，构建该轨迹序列图。(2)节点嵌入:我们提出了一个权重感知GNN模块来学习节点在RTSG中的表示。(3)轨迹嵌入:我们开发了一个基于bilstm的模块来学习每个轨迹的表示。(4)链接模块:在轨迹嵌入之后，我们将第(3)部分的输出输入到全连接的神经网络中，使用softmax函数和crossentropy loss函数进行多类分类。综上所述，

我们在本工作中做出了以下**贡献**。

* 据我们所知，我们是第一个将交通运输问题扩展到道路网络的。
* 我们开发了一个新的模型TULRN，通过充分利用道路网络的结构和轨迹的顺序信息，有效地解决TUL问题。
* 我们在现实世界的数据集上进行了广泛的实验，结果表明我们提出的模型优于最先进的方法。

# Related work

## Trajectory representation learning

由于相关研究的广泛应用，将轨迹嵌入到低维表示一直是时空数据库中热门研究课题，如轨迹聚类[24,25]、运动行为分析[26]、旅行时间和目的地预测[27-30]

## Trajectory user linking

TUL问题在[20]中首次被引入，作者提出了一种基于rnn的半监督学习模型TULER，从轨迹分割和签到嵌入开始。然后，设计了一种基于softmax的方法来将轨迹与它们的所有者联系起来。在此之后，Zhou等人[21]提出了半监督学习模型TULVAE，该模型在神经生成架构中学习人类的移动性，其中随机潜变量跨越RNN中的隐藏状态。考虑到人类轨迹的稀疏性，Miao et al.[34]提出了一种由特征表示层和具有注意机制的循环网络组成的新模型DeepTUL来解决TUL任务。DeepTUL不仅结合了管理用户移动性的多个特征来建模高阶和复杂的移动性模式，而且还从标记的历史轨迹中学习，以捕捉用户移动性的多周期本质。由于数据不足，Zhou et al.[22]引入了弹道分布逼近(TDA)问题，并提出了TGAN——一种基于生成对抗样本的个体轨迹生成算法。作为一种学习用户运动模式和位置分布的方法，TGAN旨在提高识别人类移动性的性能。由于发现当轨迹超出长度时，基于RNN的模型不能正确区分轨迹[35]。TULAR中提出了轨迹语义向量的概念，在链接时重点关注源轨迹的选定部分。TULAR通过无监督位置表示学习和RNN引入轨迹语义向量(TSV)，用于计算源轨迹部分的权重。在最近的工作中，考虑了用户个性化的移动偏好和人类流动性背后的先验知识，以更准确地联系在一起。Fan等人[23]制造了一种高效的GNNTUL模型。通过利用图神经网络获取高阶时空信息，以及从构建的图中获取签到之间的隐含转换模式，解决了人类流动性歧视问题。

然而，将轨迹与道路网络上的用户联系起来还没有得到调查。因此，我们提出了TULRN模型来解决本工作中的问题。

# Preliminaries

## Problem definition

1. **路网** 表示为一个有向图G=(V,E),其中V是节点的集合（十字路口），E是边的集合（路段）
2. **轨迹** $ p$ = (lat, lng, t)是路网上的一个样本点，Lat和lng分别表示纬度和经度，t表示时间戳，轨迹是采样点的序列，表示为τ=($p_1$，$p_2$，···，$p_n$).
3. **轨迹序列** 给定从道路网络收集的轨迹τ=($p_1$，$p_2$，···，$p_n$)，τ的轨迹序列被定义为TS(τ)=($v_k$，$e_i$，···，$e_j$，$v_l$)，其中$e_i$是路段(即，G的边)，$v_k$是交叉点(即，G的节点)。如图1,T S($τ_1$) = (v2, e2, v5, e7, v9, e10, v10)![figure1](TULRN-Trajectory-user-linking-on-road-networks/图1.png)
4. **问题表述	**给定一个道路网络G，一组用户U = {u1, u2，···，$u_n$}和一组从G中收集到的轨迹S = {τ1， τ2，···，$τ_m$}(m >> n)，我们提出的半监督模型TULRN提供了将每个轨迹$τ_i$与用户$U_j$联系起来的映射:S→U

# Overview of TULRN

![img](TULRN-Trajectory-user-linking-on-road-networks/图2.png)

**组件1**:我们根据给定的路网和轨迹的位置信息，将每条轨迹τ划分为道路段序列，对应的序列记为T S(τ)。然后，将轨迹序列与路网图合并，构建了路网感知轨迹序列图RTSG

**组件2**:为了充分利用路网的拓扑信息，我们开发了一个权重感知的GNN模块来学习RTSG中节点的表示。与朴素 GNN [36] 不同，我们在节点采样之前基于 Renyi 熵计算每条边的权重，目的是提高节点嵌入的性能。

**组件3**:我们开发了一个基于bilstm的模块，以充分利用轨迹中涉及的顺序特征。最终输出轨迹表示eτ将被送入下一个模块。

**组件 4**：多类分类模块，该模块基于完全连接的神经网络和 softmax 函数设计，经过训练可以将每个轨迹链接到其所有者。

# Proposed model TULRN

我们首先将每个轨迹转化为一系列路段。在变换之前，我们需要进行路网匹配，即将轨迹的样本点与路网对齐,为了有效地实现匹配，在本工作中，我们采用了最先进的模型(Hidden Markov map matching through noise and sparseness)基于隐马尔可夫模型并且代码可获得。

本研究的**核心**部分是通过精心设计的深度学习模块将轨迹与其所有者联系起来，因此这里省略了输入数据的预处理(即映射匹配)的细节。经过映射匹配，我们得到S中的每个轨迹τ的轨迹序列TS(τ)

## Construction of the graph RTSG

在地图匹配之后，我们构建了一个道路网络感知的轨迹序列图RTSG。具体来说，我们将轨迹序列TS(τ)的每个路段连接到图G中的一条边，并将TS(τ)的每个交叉口连接到G的一个节点。最后，通过将所有轨迹序列与给定的路网图合并，得到图RTSG

## Node embedding

大多数 GNN 模型，他们只考虑图的节点特征而忽略了边特征。为了获得固定长度的节点序列进行学习，这些方法通常使用邻接矩阵根据节点的邻居进行采样，并在采样过程中忽略边权重。当整个图中的节点数量很大时，这些方法倾向于对不可标记的节点进行采样并省略唯一节点，这将导致图特征信息的严重丢失。在观察到现有工作的缺点后，我们设计了一种**基于边权重的新型采样策略**。

我们认为，图RTSG中用户访问过的边并不同等重要。对应于热点路段的边缘通常无用于区分用户和其他用户，而较少用户访问的边缘更具区分性。基于这一思想，我们提出用**熵来计算边权重**，这是每个消息中包含的信息相对于消息的重要性的期望值（即接收的每条消息中包含的信息的平均量，是不确定性的量度--wiki）。Shannon熵是一种典型的熵，它是一种常见的工具，在许多应用中得到了广泛的应用，Renyi熵是它的推广版本，已被证明是更强大的。

边$ e$ 的 Renyi 熵定义如下,$u_i$为用户：

![3](TULRN-Trajectory-user-linking-on-road-networks/f3.PNG)

其中 $N_{ui} (e)$ 是 $u_i$ 通过与 e 对应的道路段的次数，$M_{ui}$ 表示 $u_i$ 访问过的道路段总数。参数 q 使 Renyi 熵比香农熵更具表现力和灵活性，这表明熵对数字$ N_{ui} (e)$ 的敏感性

给出了**边权**$w(e)$的定义如下:

![4](TULRN-Trajectory-user-linking-on-road-networks/f4.PNG)

除了边权重计算外，我们还在采样前根据词嵌入为RTSG中的每个节点$e_i$构造一个特征向量$f_i$。接下来，为了获得具有交互信息的每个节点的复杂表示，我们根据RTSG中从大到小的权重对边进行排序。在聚合过程中，我们对具有不同概率的节点进行采样，即权重较大的节点更有可能被采样，反之亦然

特征矩阵$ F$ = {f1, f2, · · · , $f_n$} 为每个采样点提供初始输入。假设第 k 层采样点 $p_i$（即 RTSG 中的一个节点）的表示为 $h^k_i$ ，{$h^k_ N$ } 表示第 k 层 $p_i$ 采样的节点序列的表示(个人理解是包含该采样点的轨迹表示)，第 (k + 1) 层采样点 $p_i$ 的表示为

![5](TULRN-Trajectory-user-linking-on-road-networks/图5.PNG)

在节点嵌入之后，我们可以获得基于轨迹序列的轨迹表示。作为说明，图3中的红色和蓝色虚线分别表示RTSG中τ1和τ2的轨迹序列。然后，我们可以通过连接p3、p4、p5和p7的嵌入来获得轨迹表示$e_{τ1}$。类似地，表示$e_{τ2}$是通过连接p7、p6、p1和p3的嵌入而获得的

![img](TULRN-Trajectory-user-linking-on-road-networks/图3.png)

## BiLSTM-based trajectory embedding

为了进一步利用轨迹所包含的序列信息进行更好的表示学习，构建了一个基于BiLSTM的模块，其输入是轨迹嵌入，该模块包含丰富的道路网络拓扑信息，通过权重感知GNN模块学习。

BiLSTM是前向LSTM和后向LSTM的组合。在时间t，BiLSTM的输出轨迹表示是前向LSTM的$h_t$和后向LSTM$\widehat{h_t}$的串联，即

![6](TULRN-Trajectory-user-linking-on-road-networks/f6.PNG)

充分利用基于GNN的模块捕获拓扑信息和基于BiLSTM的模块捕获序列特征，我们获得了最终有效的轨迹表示，这是下一个链接模块的输入。

## Trajectory user linking

在道路网络上的轨迹表示学习之后，我们将轨迹链接到生成它们的用户，链接模块的体系结构如图4所示。

![img](TULRN-Trajectory-user-linking-on-road-networks/图4.png "图4")

链接涉及两部分，即全连接多层感知(MLP)和softmax。

MLP的输入是轨迹的表示$e_τ$，我们假设在计算$W_{e_τ}$ + b后MLP的输出是Y = (y1, y2，···，$y_n$)，那么softmax中的每个概率p($y_i$)定义为

![img](TULRN-Trajectory-user-linking-on-road-networks/f7.PNG)

其中 W 和 b 分别表示 MLP 中的权重矩阵和偏置向量。预测标签由 $\widehat{y}$= argmax p($y$) 生成。

TUL可以视为一个多分类任务，将交叉熵作为损失函数，并使用反向传播和 Adam [41] 来训练我们的模型。

损失函数为：![img](TULRN-Trajectory-user-linking-on-road-networks/f8.PNG)

其中L是训练中使用的轨迹数，$g_i$是轨迹的one-hot表示的ground truth。

# Experiment study

首先，介绍了实验设置，数据集的统计数据，比较方法和评估指标。然后，比较了提出的模型TULRN与基线的性能，并讨论了参数的影响。值得注意的是，所有算法都是用Python 3.8实现的，并运行在具有256GB内存的Linux服务器上.

## Experimental setup

将图RTSG中的节点维数设置为250，迭代次数设置为100。序列的最大长度为50，批大小为64,TULRN的学习率为0.0001。

## Dataset

从**北京市采集道路网络**，包括56201个交叉口和75268个路段，其中包括306954个样本点，地图如图5所示。用于进行轨迹用户链接的轨迹数据集包含10567条轨迹，415216个样本点，由2012年10月1日至2012年10月7日的493辆出租车(即用户)生成。我们将每个用户的轨迹数据集按照7:3的比例划分为训练集和测试集.

**支持数据的可用性实验中路网和轨迹数据是*非公共数据集*。**

## Compared methods

对比了以下方法：

* TULER：该模型有两个变体(即TULER-LSTM和TULER-GRU)，通过将轨迹嵌入LSTM，该模型在更多的评价指标上表现更好，因此我们在本工作中再现了变体TULER-LSTM。
* TULVAE：TUL问题是通过半监督学习框架来解决的，该框架通过随机潜在变量在RNN中跨越隐藏状态来学习神经生成体系中的人类移动性。
* TLUTE：利用基于图的位置嵌入方法来学习位置语义，与GRU相比，LSTM嵌入轨迹具有更好的性能。因此，我们用TULTE-LSTM实现了该方法。
* AdattTUL：为了对TUL问题进行对抗性迁移学习，提出了AdattTUL模型。为了训练模型，考虑了多种人类偏好，并使用注意机制从轨迹数据动态捕获用户签到的复杂关系。
* DeepTUL：该模型由特征表示层和具有注意机制的注意循环网络组成，既结合了控制用户移动性的多个特征，又从标记的历史轨迹中学习
* GNNTUL：是第一个基于gnn的人类移动学习模型，它利用了社交网络上稀疏用户痕迹背后的隐式过渡模式，同时提取用户独特的运动特征并区分运动痕迹。

## Evaluation metrics

TUL任务可以看作是一个多类分类问题。我们使用ACC@K和Macro-F1来评估性能，这是多类分类领域常用的指标

其中，ACC@K用于评估预测的准确性，可表示为:

![img](TULRN-Trajectory-user-linking-on-road-networks/f9.PNG)

而Macro-F1是精度(Macro-P)和召回率(Macro-R)的调和平均值，它们在所有类别中都是平均的:

![img](TULRN-Trajectory-user-linking-on-road-networks/f10.PNG)

## Experimental resultsExperimental results

![img](TULRN-Trajectory-user-linking-on-road-networks/f11.PNG)

由此可见，TULVAE比TULER表现更好，因为它能够捕捉迁移模式的语义，并将未标记的数据纳入到训练中。虽然采用了变体LSTM，但TULER在建模序列信息时存在生成较浅的问题。TLUTE利用轨迹的空间和时间信息挖掘用户的底层运动模式，并利用该模式来提高TUL的性能，因此TLUTE的性能优于TULER和TULVAE。AdattTUL模型利用轨迹编码中的注意机制来处理每个路段的重要性，这使得该模型的性能优于trute模型。DeepTUL的表现优于除GNNTUL外的所有基线，这是因为模型的注意力模块学习了用户在每个路段上移动的多周期性，并生成当前轨迹最相关的上下文，以提高精度。

最近的研究GNNTUL在所有比较方法中表现最好，原因是GNNTUL中的GNN模块捕获位置之间的空间和高阶相关性，并通过合理的转换模式将不存在引入到编码的位置嵌入向量中。毫无疑问，我们提出的模型TULRN优于其他方法，原因是双重的。(1)与现有的基于位置信息的轨迹分割方法相比，基于道路网络得到的轨迹序列更能表征用户的顺序行为。(2)权重感知GNN模块和基于bilstm的模块分别充分利用了轨迹所涉及的拓扑和顺序信息

## Ablation study

具体来说，我们使用 TULRN 中的权重感知 GNN 模块来利用道路网络的拓扑信息，并使用基于 BiLSTM 的模块在轨迹嵌入期间利用轨迹的顺序特征。为了分别研究这两个模块带来的好处，我们开发了以下基线（即 TUL-GNN 和 TUL-BiLSTM）。从表 5 可以看出，模型 TULRN 的性能比 TUL-GNN 和 TUL-BiLSTM 好得多，因为同时考虑了道路网络的结构和轨迹的顺序特征。相比之下，TUL-GNN 和 TUL-BiLSTM 中只考虑了这两个特征之一。表 5 中的结果证明了权重感知 GNN 模块和基于 Bi-LSTM 的高性能轨迹嵌入模块的有效性和不可补偿性

![img](TULRN-Trajectory-user-linking-on-road-networks/f12.PNG)

## Analysis of parameters

**改变嵌入大小** 

节点嵌入的维度对于 TULRN 至关重要，测试了它在将嵌入大小从 50 更改为 400 时的性能。从中观察，我们提出的模型 TULRN 实现了更高的 ACC@1、ACC@5 和 Macro-F1，嵌入大小的增加。这是因为学习向量将在这一进展中包含更多的潜在信息。此外，我们观察到 ACC@1 和 Macro-F1 的维度从 250 到 400 几乎没有变化，尤其是 ACC@5 几乎保持不变。因此，我们将节点嵌入大小设置为 250，目的是节省运行时间和内存成本

**不同数量的迭代** 

另一个需要研究的重要因素是迭代次数。随着这个数字的增加，TULRN 获得了更高的 ACC@1、ACC@5 和 MacroF1，因为 TULRN 中的参数在此进展中进行了优化。此外，我们观察到将迭代次数设置为 100 就足够了，过大的迭代数需要更多的运行时间和内存成本，并可能导致过拟合问题。因此，我们在这项工作中将此数字设置为 100

**不同的学习率 TULRN 的性能**

学习率的增加首先提高了TULRN的性能，因为在这一过程中可以避免局部最优。然而，该模型可能会以太大的学习率错过全局最优。最后，在这项工作中，该参数设置为 0.005。

**不同的 dropout**

正如预期的那样，dropout 的增加最初导致 TULRN 的性能增加，因为在这个进展中可以进一步缓解过度拟合的问题。然而，过大的 dropout 也可能导致信息丢失。为了获得 TULRN 的最佳性能，我们在实验中将 dropout 设置为 0.025。

# Conclusion and future work

近年来，由于研究基础的广泛应用，轨迹用户链接问题受到越来越多的关注。尽管传统研究做出了巨大贡献，但还没有工作专注于解决道路网络上的问题。为了填补这一空白，我们提出了一种新的模型TULRN，该模型不同于现有工作，有两个特点:(1)开发了一种称为RTSG的路网感知轨迹序列图来重组输入轨迹;(2)嵌入过程中充分利用了给定路网的结构和轨迹顺序信息。在真实数据集上进行的实验结果表明，我们提出的模型优于最先进的方法。在未来的工作中，我们可以考虑时间信息来更好地进行轨迹表示学习。此外，TUL 问题可以扩展到多个平台，其中需要一种新颖的剪枝策略来修剪搜索空间。
